library(qqman)
png("plinkassoc_qc.png", res = 1200, height = 7, width = 10, units = "in")
par(mfrow=c(1,1))
manhattan(assoc, chr = "CHR", bp = "BP", p = "P", col = c("gray10", "gray60"), chrlabs = NULL,
suggestiveline = -log10(1e-05),  genomewideline = -log10(5e-08), highlight = NULL, logp = T,
annotatePval = NULL, annotateTop = T)
dev.off()
png("plinkassoc_qc.png", res = 1200, height = 7, width = 10, units = "in")
dev.off()
assoc=read.table("qc-camgwas.assoc.logistic", header=T, as.is=T)
png("plinkassoc_qc.png", res = 1200, height = 7, width = 10, units = "in")
manhattan(assoc, chr = "CHR", bp = "BP", p = "P", col = c("gray10", "gray60"), chrlabs = NULL,
dev.off()
png("plinkassoc_qc.png", res = 1200, height = 7, width = 10, units = "in")
par(mfrow=c(1,1))
manhattan(assoc, chr = "CHR", bp = "BP", p = "P", col = c("gray10", "gray60"), chrlabs = NULL,
suggestiveline = -log10(1e-05),  genomewideline = -log10(5e-08), highlight = NULL, logp = T,
annotatePval = NULL, annotateTop = T)
dev.off()
############################ Cameroon GWAS Data Analysis ##############################
############################### Prepare Sample File ###################################
oldsam=read.table("raw-camgwas-data.sample", header = T, as.is = T)
newsam=read.table("raw-camgwas.sample", header = T, as.is = T)
View(oldsam)
View(newsam)
# change sample file name for sample file accompanying .gen file
write.table(newsam, file = "camgwas_template.sample", col.names = T, row.names = F, quote = F)
# Now create new sample file with same name as .gen file  (for plink input)
newcamsam=data.frame(newsam[,1:3], oldsam[,4:15])
View(newcamsam)
write.table(newcamsam, file = "raw-camgwas.sample", col.names = T, row.names = F, quote = F)
############ PER INDIVIDUAL QC ######################
### Plot Heterozygosity vs Missingness
het=read.table("raw-camgwas.het", header = T, as.is = T)
mis=read.table("raw-camgwas.imiss", header = T, as.is = T)
# save the file reformatted
write.table(het, file = "raw-camgwas.het", col.names = T, row.names = F, quote = F, sep = "\t")
write.table(mis, file = "raw-camgwas.imiss", col.names = T, row.names = F, quote = F, sep = "\t")
# Calculate the observed heterozygosity rate per individual by (N(NM) - O(HOM)/N(NM))
mishet=data.frame(FID=het$FID, IID=het$IID, het.rate=(het$N.NM. - het$O.HOM.)/het$N.NM., mis.rate=mis$F_MISS)
plot(mishet$het.rate, mishet$mis.rate, xlab = "Heterozygous rate", ylab = "Proportion of missing genotype", pch=20)
#abline(v=c(hetlower, hetupper), h=0.1, lty=2)
abline(v=c(0.195,0.22), h=0.1, lty=2)
legend("bottomright", legend = "dashed line: y = 0.1, x = 0.195-0.22")
dev.off()
plot(mishet$het.rate, mishet$mis.rate, xlab = "Heterozygous rate", ylab = "Proportion of missing genotype", pch=20)
#abline(v=c(hetlower, hetupper), h=0.1, lty=2)
abline(v=c(0.195,0.22), h=0.1, lty=2)
dev.off()
plot(mishet$het.rate, mishet$mis.rate, xlab = "Heterozygous rate", ylab = "Proportion of missing genotype", pch=20)
#abline(v=c(hetlower, hetupper), h=0.1, lty=2)
abline(v=c(0.19,0.22), h=0.1, lty=2)
dev.off()
plot(mishet$het.rate, mishet$mis.rate, xlab = "Heterozygous rate", ylab = "Proportion of missing genotype", pch=20)
#abline(v=c(hetlower, hetupper), h=0.1, lty=2)
abline(v=c(0.18,0.25), h=0.1, lty=2)
dev.off()
plot(mishet$het.rate, mishet$mis.rate, xlab = "Heterozygous rate", ylab = "Proportion of missing genotype", pch=20)
#abline(v=c(hetlower, hetupper), h=0.1, lty=2)
abline(v=c(0.18,0.23), h=0.1, lty=2)
# Extract individuals that will be excluded from further analysis (who didn't pass the filter)
# Individuals with mis.rate > 0.1 (10% missingness)
fail_mis_qc=mishet[mishet$mis.rate > 0.1, ]
write.table(fail_mis_qc[,1:2], file = "fail-mis-qc.txt", row.names = F, col.names = F, quote = F, sep = "\t")
fail_mis_qc
# Individuals with het.rate < 0.18 (previously 0.195) and individuals with het.rate > o.23 (previously 0.22)
fail_het_qc=mishet[mishet$het.rate < 0.18 | mishet$het.rate > 0.23, ]
write.table(fail_het_qc[,1:2], file = "fail-het.qc", row.names = F, col.names = F, quote = F, sep = "\t")
fail_het_qc
############ Extract IDs of individuals that failed sex check from the .sexcheck file ##############
sexcheck=read.table("fail-checksex.qc", header = F, as.is = T)
sexcheck
write.table(sexcheck, file = "fail-checksex.qc", col.names = F, row.names = F, quote = F, sep = "\t")
# IBD Calculation
genome=read.table("caseconpruned.genome", header = T, as.is = T)
genome=genome[genome$PI_HAT > 0.1875, ]
# Compute mean IBD
mean_ibd=0*genome$Z0 + 1*genome$Z1 + 2*genome$Z2
# Compute the variance of IBD
var.ibd=((0 - mean_ibd)^2)*genome$Z0 +
((1 - mean_ibd)^2)*genome$Z1 +
((2 - mean_ibd)^2)*genome$Z2
# Compute standard error
se.ibd=sqrt(var.ibd)
plot(mean_ibd, se.ibd, xlab = "Mean IBD", ylab = "SE IBD", pch=20, main = "SE IBD of Pairs with Pi HAT > 0.1875")
plot(genome$Z0, genome$Z1, col=1, ylab = "Z1", xlab = "Z0", pch=20)
png("ibd_analysis.png", res=1200, height = 10, width = 10, units = "in")
dev.off()
png("ibd_analysis.png", res=1200, height = 10, width = 10, units = "in")
par(mfrow=c(2,1)) # Set parameters to plot ibd_analysis and ibd_se
plot(mean_ibd, se.ibd, xlab = "Mean IBD", ylab = "SE IBD", pch=20, main = "SE IBD of Pairs with Pi HAT > 0.1875")
plot(genome$Z0, genome$Z1, col=1, ylab = "Z1", xlab = "Z0", pch=20)
dev.off()
duplicate1=genome[mean_ibd == 2, ] # monozygotic twins
duplicate2=genome[mean_ibd > 1.98, ] # Equivalent to Z2 > 0.98. Apparently, there were no monozygotic twins but duplicates
sibs=genome[mean_ibd == 1, ]
sibs
# Extract IDs of the duplicate pairs and check in the original data set to see which have a lower call rate)
write.table(duplicate2[,1:2], file = "duplicate_ids1.txt", col.names = F, row.names = F, quote = F, sep = "\t")
write.table(duplicate2[,3:4], file = "duplicate_ids2.txt", col.names = F, row.names = F, quote = F, sep = "\t") # Has the higer missingness
######## SNP QC ###############
lmiss=read.table("ind-qc-camgwas.lmiss", header = T, as.is = T)
hist(log10(lmiss$F_MISS), ylab = "Number of SNPs", xlab = "Fraction of missing genotypes", main = "Fraction of missing data")
# placing a line at 4% missing data point
abline(v=log10(0.04), lty=2)
# Examining minor allele frequency
freq=read.table("ind-qc-camgwas.frq", header = T, as.is = T)
hist(freq$MAF, ylab = "Number of SNPs", xlab = "MAF", main = "Minor Allele Frequencies")
# Include lines for 1% (0.01) and 5% (0.05) MAFs
abline(v=0.01, lty=2, col="red")
abline(v=0.05, lty=2, col="green")
dev.off()
hist(log10(lmiss$F_MISS), ylab = "Number of SNPs", xlab = "Fraction of missing genotypes", main = "Fraction of missing data")
# placing a line at 4% missing data point
abline(v=log10(0.04), lty=2)
dev.off()
# Assess differential genotype call rate between cases and controls
diffmiss=read.table("ind-qc-camgwas.missing", header = T, as.is = T)
# save SNPs with missing call rate at p-value < 0.000001 (I'll choose to use 1x10^-8 since its the same genome-wide significance threshold I'll use)
diffmiss=diffmiss[diffmiss$P<0.000001, ]
write.table(diffmiss$SNP, file = "fail-diffmiss-qc.txt", row.names = F, col.names = F, quote = F)
############ Extract IDs of individuals that failed sex check from the .sexcheck file ##############
sexcheck=read.table("fail-checksex.qc", header = F, as.is = T)
write.table(sexcheck, file = "fail-checksex.qc", col.names = F, row.names = F, quote = F, sep = "\t")
head(sexcheck)
write.table(sexcheck[,1:2], file = "fail-checksex.qc", col.names = F, row.names = F, quote = F, sep = "\t")
head(sexcheck)
sexcheck=read.table("fail-checksex.qc", header = F, as.is = T)
head(sexcheck)
